{% extends 'base_for_test.html' %}
{% block title %}ç•ªèŒ„é’Ÿè¿›è¡Œä¸­{% endblock %}

{% block content %}

<main class="content-area">
    {% if is_time_up %}
        <!-- è‡ªåŠ¨åˆ·æ–°é€»è¾‘ï¼šæ—¶é—´åˆ°äº†ï¼Œæ¯5ç§’åˆ·æ–°ä¸€æ¬¡æé†’ -->
        <meta http-equiv="refresh" content="5">

        <div class="glass-card time-up-card">
            <h1 class="pulse" style="color: #d32f2f; font-size: 56px; margin-bottom: 10px;">â° æ—¶é—´åˆ°ï¼</h1>
            <div class="course-badge" style="background: rgba(211, 47, 47, 0.1); color: #d32f2f;">
                {{ pomodoro.course.name }}
            </div>
            <p style="font-size: 20px; color: #555; margin: 20px 0;">
                ä¸“æ³¨æ—¶é—´å·²ç»“æŸï¼Œå»ºè®®ä¼‘æ¯ <strong>{{ pomodoro.break_time }}</strong> åˆ†é’Ÿã€‚
            </p>
            <div class="btn-group">
                <a href="{% url 'pomodoro_complete' pomodoro.pk %}" class="btn btn-success" style="font-size: 1.2em; padding: 15px 40px;">å®Œæˆç•ªèŒ„é’Ÿ</a>
            </div>
        </div>

    {% else %}
        <!-- è‡ªåŠ¨åˆ·æ–°é€»è¾‘ï¼šæœªåˆ°æ—¶é—´ï¼Œæ¯30ç§’åˆ·æ–°ä¸€æ¬¡ -->
        <meta http-equiv="refresh" content="30">

        <div class="glass-card">
            <div class="course-badge">ğŸ… {{ pomodoro.course.name }}</div>
            <h2 style="color: #333; font-weight: 400;">ä¸“æ³¨ä¸­...</h2>

            <div class="timer-display">
                {% if remaining_minutes > 0 %}
                    {{ remaining_minutes|floatformat:0 }}<span style="font-size: 24px;"> åˆ†é’Ÿ</span>
                {% else %}
                    < 1<span style="font-size: 24px;"> åˆ†é’Ÿ</span>
                {% endif %}
            </div>

            <div class="progress-container">
                <div class="progress-bar" style="width: {% widthratio elapsed_minutes pomodoro.focus_time 100 %}%"></div>
            </div>

            <div class="info-text">
                å·²åšæŒï¼š<strong>{{ elapsed_minutes|floatformat:1 }}</strong> åˆ†é’Ÿ / ç›®æ ‡ï¼š{{ pomodoro.focus_time }} åˆ†é’Ÿ
            </div>

            <p style="color: #999; font-size: 13px; margin-top: 20px;">
                <i class="fas fa-sync-alt"></i> é¡µé¢æ¯ 30 ç§’è‡ªåŠ¨åŒæ­¥è¿›åº¦
            </p>

            <div class="btn-group">
                <a href="{% url 'pomodoro_complete' pomodoro.pk %}" class="btn btn-danger">æå‰ç»“æŸ</a>
                <a href="{% url 'pomodoro_list' %}" class="btn btn-secondary">è¿”å›åˆ—è¡¨</a>
            </div>
        </div>
    {% endif %}
</main>

<style>
    /* å€’è®¡æ—¶æ•°å­— */
    .timer-display {
        font-size: 84px;
        font-weight: 800;
        color: #9ed1e1;
        margin: 20px 0;
        text-shadow: 0 4px 10px rgba(255, 94, 87, 0.2);
    }

    /* è¯¾ç¨‹åç§° */
    .course-badge {
        display: inline-block;
        padding: 8px 20px;
        background: rgba(110, 142, 251, 0.1);
        color: #6e8efb;
        border-radius: 30px;
        font-size: 1.2em;
        font-weight: bold;
        margin-bottom: 20px;
    }

    /* è¿›åº¦æ¡å®¹å™¨ */
    .progress-container {
        background: rgba(0, 0, 0, 0.05);
        height: 12px;
        border-radius: 6px;
        overflow: hidden;
        margin: 30px auto;
        max-width: 500px;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #6e8efb, #a777e3);
        transition: width 1s linear;
        border-radius: 6px;
    }

    /* æ—¶é—´åˆ°çŠ¶æ€å¡ç‰‡ */
    .time-up-card {
        background: rgba(255, 235, 59, 0.2);
        border: 2px solid #fbc02d;
    }

    /* æŒ‰é’®æ ·å¼ */
    .btn-group {
        margin-top: 35px;
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    .btn {
        padding: 12px 25px;
        border-radius: 10px;
        text-decoration: none;
        font-weight: bold;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .btn-success { background: #4caf50; color: white; }
    .btn-danger { background: #ff5e57; color: white; }
    .btn-secondary { background: #9e9e9e; color: white; }

    /* å‘¼å¸ç¯åŠ¨ç”» */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    .pulse { animation: pulse 2s infinite ease-in-out; }

    .info-text {
        color: #666;
        font-size: 0.95em;
        margin: 10px 0;
    }
</style>
{% endblock %}