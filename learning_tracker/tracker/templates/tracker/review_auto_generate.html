{% extends 'base_for_test.html' %}
{% block title %}è‡ªåŠ¨ç”Ÿæˆå¤ä¹ è®¡åˆ’{% endblock %}
{% block content %}
<main class="content-area">
    <div class="glass-card">
        <div class="header-section">
            <h2>æ™ºèƒ½å¤ä¹ ç”Ÿæˆ</h2>
            <p>åŸºäº<strong>è‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿</strong>ï¼Œç§‘å­¦è§„åˆ’æ‚¨çš„å­¦ä¹ è¿›åº¦</p>
        </div>

        <form method="post">
            {% csrf_token %}

            <div class="form-group">
                <label>é€‰æ‹©è¯¾ç¨‹</label>
                <select name="course_id" class="form-control" required>
                    <option value="">-- è¯·é€‰æ‹©ç›®æ ‡è¯¾ç¨‹ --</option>
                    {% for course in courses %}
                    <option value="{{ course.pk }}">{{ course.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="form-group">
                <label>é€‰æ‹©å­¦ä¹ èµ„æ–™ï¼ˆå¯é€‰ï¼‰</label>
                <select name="material_id" id="material-select" class="form-control">
                    <option value="">-- å…¨éƒ¨èµ„æ–™ --</option>
                </select>
                <small style="color: #999; margin-top: 5px; display: block;">é€‰æ‹©ç‰¹å®šèµ„æ–™å¯ç”Ÿæˆæ›´ç²¾å‡†çš„å¤ä¹ ä»»åŠ¡</small>
            </div>

            <div class="action-group">
                <button type="submit" class="btn-primary">ç«‹å³ç”Ÿæˆå¤ä¹ è®¡åˆ’</button>
                <a href="{% url 'review_list' %}" class="btn-link">å–æ¶ˆè¿”å›</a>
            </div>
        </form>

        <!-- ç®—æ³•è¯´æ˜å¡ç‰‡ -->
        <div class="algorithm-info">
            <h3><span style="font-size: 1.2em;">ğŸ“ˆ</span> é—å¿˜æ›²çº¿å¤ä¹ å‘¨æœŸ</h3>
            <ul>
                <li><strong>1st</strong> å­¦ä¹ å 1 å¤©</li>
                <li><strong>2nd</strong> å­¦ä¹ å 3 å¤©</li>
                <li><strong>3rd</strong> å­¦ä¹ å 7 å¤©</li>
                <li><strong>4th</strong> å­¦ä¹ å 15 å¤©</li>
                <li><strong>5th</strong> å­¦ä¹ å 30 å¤©</li>
                <li><strong>Long</strong> ä¹‹åæ¯ 30 å¤©</li>
            </ul>
            <p style="margin-top: 15px; font-size: 0.85em; color: #888;">
                ç³»ç»Ÿå°†æ‰«ææ‚¨æœ€è¿‘çš„å­¦ä¹ è½¨è¿¹ï¼Œè‡ªåŠ¨è®¡ç®—ä¸‹æ¬¡å¤ä¹ çš„æœ€ä½³æ—¶é—´ç‚¹ï¼Œç¡®ä¿çŸ¥è¯†ç‚¹è¿›å…¥é•¿æ—¶è®°å¿†ã€‚
            </p>
        </div>
    </div>
</main>

<style>
    /* æ ‡é¢˜ä¸æè¿° */
    .header-section {
        margin-bottom: 30px;
        text-align: center;
    }

    .header-section h2 {
        color: #333;
        margin-bottom: 10px;
    }

    .header-section p {
        color: #666;
        font-size: 0.95em;
    }

    /* è¡¨å•ç»„æ ·å¼ */
    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #444;
    }

    .form-control {
        width: 100%;
        padding: 12px 15px;
        border-radius: 10px;
        border: 1px solid rgba(0, 0, 0, 0.1);
        background: rgba(255, 255, 255, 0.5);
        font-size: 1em;
        outline: none;
        transition: border-color 0.3s, box-shadow 0.3s;
    }

    .form-control:focus {
        border-color: #6e8efb;
        box-shadow: 0 0 0 3px rgba(110, 142, 251, 0.1);
    }

    /* æŒ‰é’®ç»„ */
    .action-group {
        display: flex;
        align-items: center;
        gap: 20px;
        margin-top: 30px;
    }

    .btn-primary {
        background: linear-gradient(135deg, #6e8efb, #a777e3);
        color: white;
        text-decoration: none;
        border-radius: 10px;
        padding: 12px 30px;
        font-weight: bold;
        border: none;
        cursor: pointer;
        transition: transform 0.2s, opacity 0.3s;
    }

    .btn-primary:hover {
        opacity: 0.9;
        transform: translateY(-1px);
    }

    .btn-link {
        color: #666;
        text-decoration: none;
        font-size: 0.95em;
    }

    .btn-link:hover {
        text-decoration: underline;
    }

    /* ç®—æ³•è¯´æ˜åŒº */
    .algorithm-info {
        margin-top: 40px;
        padding: 25px;
        background: rgba(110, 142, 251, 0.05);
        border-radius: 15px;
        border-left: 5px solid #6e8efb;
    }

    .algorithm-info h3 {
        color: #6e8efb;
        font-size: 1.1em;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .algorithm-info ul {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 10px;
        padding: 0;
        list-style: none;
    }

    .algorithm-info li {
        font-size: 0.9em;
        color: #555;
        background: white;
        padding: 8px 12px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.03);
    }

    .algorithm-info li strong {
        color: #a777e3;
    }
</style>

<script id="materials-data" type="application/json">{{ materials_by_course_json|safe }}</script>
<script>
// åŠ¨æ€åŠ è½½å­¦ä¹ èµ„æ–™é€»è¾‘ä¿æŒä¸å˜
const materialsByCourse = JSON.parse(document.getElementById('materials-data').textContent);
const courseSelect = document.querySelector('select[name="course_id"]');
const materialSelect = document.getElementById('material-select');

courseSelect.addEventListener('change', function() {
    const courseId = this.value;
    materialSelect.innerHTML = '<option value="">-- å…¨éƒ¨èµ„æ–™ --</option>';

    if (courseId && materialsByCourse[courseId]) {
        const materials = materialsByCourse[courseId];
        materials.forEach(function(material) {
            const option = document.createElement('option');
            option.value = material.id;
            option.textContent = material.name;
            materialSelect.appendChild(option);
        });
    }
});
</script>
{% endblock %}